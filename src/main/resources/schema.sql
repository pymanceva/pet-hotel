DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS pets CASCADE;
DROP TABLE IF EXISTS rooms CASCADE;
DROP TABLE IF EXISTS categories CASCADE;
DROP TABLE IF EXISTS bookings CASCADE;
DROP TABLE IF EXISTS pets_in_bookings CASCADE;

CREATE TABLE IF NOT EXISTS users
(
    id    BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name  VARCHAR(255)                            NOT NULL,
    email VARCHAR(254)                            NOT NULL,
    role  VARCHAR(16)                             NOT NULL,
    CONSTRAINT pk_user PRIMARY KEY (id),
    CONSTRAINT UQ_USER_EMAIL UNIQUE (email)
);

INSERT INTO users (name, email, role) values ('boss', 'boss@mail.ru', 'ROLE_BOSS');

CREATE TABLE IF NOT EXISTS pets
(
    id_pets                        BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    type_pets                      VARCHAR(10)                             NOT NULL,
    name_pets                      VARCHAR(30)                             NOT NULL,
    breed_pets                     VARCHAR(30)                             NOT NULL,
    birth_date_pets                TIMESTAMP WITHOUT TIME ZONE             NOT NULL,
    sex_pets                       VARCHAR(13)                             NOT NULL,
    color_pets                     VARCHAR(30)                                     ,
    sign_pets                      VARCHAR(150)                                    ,
    exhibition_pets                BOOLEAN                                         ,
    vet_visit_pets                 TIMESTAMP WITHOUT TIME ZONE                     ,
    reason_vet_visit_pets          VARCHAR(250)                                    ,
    vaccine_pets                   VARCHAR(250)                                    ,
    parasites_pets                 VARCHAR(250)                                    ,
    flea_mite_pets                 VARCHAR(250)                                    ,
    surgery_pets                   VARCHAR(250)                                    ,
    past_disease_pets              VARCHAR(500)                                    ,
    health_characteristic_pets     VARCHAR(500)                                    ,
    urine_analysis_pets            VARCHAR(250)                                    ,
    allergy_pets                   BOOLEAN                                         ,
    allergy_type_pets              VARCHAR(250)                                    ,
    chronic_disease_pets           BOOLEAN                                         ,
    chronic_disease_type_pets      VARCHAR(500)                                    ,
    heat_date_pets                 TIMESTAMP WITHOUT TIME ZONE                     ,
    vet_data_pets                  VARCHAR(500)                                    ,
    stay_without_master_pets       VARCHAR(500)                                    ,
    stay_alone_pets                VARCHAR(250)                                    ,
    special_care_pets              VARCHAR(500)                                    ,
    bark_howl_pets                 VARCHAR(250)                                    ,
    furniture_damage_pets          VARCHAR(250)                                    ,
    food_from_table_pets           VARCHAR(250)                                    ,
    defecate_at_home_pets          VARCHAR(250)                                    ,
    mark_at_home_pets              VARCHAR(250)                                    ,
    new_people_pets                VARCHAR(500)                                    ,
    bite_people_pets               BOOLEAN                                         ,
    reason_of_bite_pets            VARCHAR(250)                                    ,
    play_with_dogs_pets            VARCHAR(500)                                    ,
    dog_training_pets              BOOLEAN                                         ,
    training_name_pets             VARCHAR(500)                                    ,
    like_pets                      VARCHAR(500)                                    ,
    not_like_pets                  VARCHAR(500)                                    ,
    toys_pets                      VARCHAR(500)                                    ,
    bad_habit_pets                 VARCHAR(250)                                    ,
    walking_pets                   VARCHAR(250)                                    ,
    morning_walking_pets           VARCHAR(150)                                    ,
    day_walking_pets               VARCHAR(150)                                    ,
    evening_walking_pets           VARCHAR(150)                                    ,
    feeding_quantity_pets          INTEGER                                         ,
    feed_type_pets                 VARCHAR(250)                                    ,
    feed_name_pets                 VARCHAR(250)                                    ,
    feed_composition_pets          VARCHAR(250)                                    ,
    feeding_rate_pets              VARCHAR(250)                                    ,
    feeding_practice_pets          VARCHAR(500)                                    ,
    treat_pets                     VARCHAR(250)                                    ,
    medicine_pets                  BOOLEAN                                         ,
    medicine_regimen_pets          VARCHAR(500)                                    ,
    additional_data_pets           VARCHAR(1000)                                   ,
    CONSTRAINT pk_pet PRIMARY KEY (id_pets)
);

--INSERT INTO pets (birth_date_pets, breed_pets, name_pets, sex_pets, type_pets)
--VALUES ('09.06.2023', 'Спаниель', 'Барбос', 'FEMALE', 'DOG');

CREATE TABLE IF NOT EXISTS categories
(
    id_categories          BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name_categories        VARCHAR(20)                             NOT NULL,
    description_categories VARCHAR(250)                                    ,
    CONSTRAINT pk_categories PRIMARY KEY (id_categories),
    CONSTRAINT UQ_CATEGORY_NAME UNIQUE(name_categories)
);

--INSERT INTO categories (name_categories, description_categories)
--VALUES ('Номер для собак', 'Номер для собак, антивандальная отделка, оснащен лежаками, мисками');

CREATE TABLE IF NOT EXISTS rooms
(
    id_rooms          BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    number_rooms      VARCHAR(100)                            NOT NULL,
    area_rooms        REAL                                            ,
    category_id_rooms BIGINT                                          ,
    description_rooms VARCHAR(250)                                    ,
    visible_rooms     BOOLEAN DEFAULT TRUE                            ,
    CONSTRAINT pk_rooms PRIMARY KEY (id_rooms),
    CONSTRAINT fk_cat_to_rooms FOREIGN KEY (category_id_rooms) REFERENCES categories(id_categories) ON DELETE RESTRICT,
    CONSTRAINT UQ_ROOM_NUMBER UNIQUE(number_rooms),
    CONSTRAINT positive_room_area CHECK (area_rooms >= 0)
);

--INSERT INTO rooms (number_rooms, area_rooms, category_id_rooms, description_rooms, visible_rooms)
--VALUES ('1F', 10, 1, 'Номер с отдельным входом', true);

CREATE TABLE IF NOT EXISTS bookings
(
    id_bookings                BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    type_bookings              VARCHAR(50)                             NOT NULL,
    check_in_date_bookings     DATE                                    NOT NULL,
    check_out_date_bookings    DATE                                    NOT NULL,
    check_in_time_bookings     TIME                                            ,
    check_out_time_bookings    TIME                                            ,
    status_bookings            VARCHAR(50)                             NOT NULL,
    reason_of_stop_bookings    VARCHAR(50)                                     ,
    reason_of_cancel_bookings  VARCHAR(150)                                    ,
    price_bookings             REAL DEFAULT 0                          NOT NULL,
    amount_bookings            REAL DEFAULT 0                          NOT NULL,
    prepayment_amount_bookings REAL DEFAULT 0                          NOT NULL,
    made_prepayment_bookings   BOOLEAN DEFAULT FALSE                           ,
    comment_bookings           VARCHAR(150)                                    ,
    file_bookings              VARCHAR(150)                                    ,
    room_id_bookings           BIGINT                                          ,
    CONSTRAINT pk_bookings PRIMARY KEY (id_bookings),
    CONSTRAINT fk_room_to_bookings FOREIGN KEY (room_id_bookings) REFERENCES rooms(id_rooms) ON DELETE RESTRICT,
    CONSTRAINT positive_price_bookings CHECK (price_bookings >= 0),
    CONSTRAINT positive_amount_bookings CHECK (amount_bookings >= 0),
    CONSTRAINT positive_prepayment_amount_bookings CHECK (prepayment_amount_bookings >= 0),
    CONSTRAINT check_out_later_than_in CHECK (check_out_date_bookings >= check_in_date_bookings)
);

CREATE TABLE IF NOT EXISTS pets_in_bookings
(
    id_bookings BIGINT,
    id_pets     BIGINT,
    PRIMARY KEY (id_bookings, id_pets),
    CONSTRAINT fk_id_bookings FOREIGN KEY (id_bookings) REFERENCES bookings (id_bookings),
    CONSTRAINT fk_id_pets FOREIGN KEY (id_pets) REFERENCES pets (id_pets)
);

